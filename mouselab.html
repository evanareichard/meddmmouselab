<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mouselab Experiment</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100%;
      margin: 0;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 15px;
      width: 90%;
    }
    .cell {
      width: 300px;
      height: 150px;
      background-color: #ddd;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      border: 1px solid #ccc;
      position: relative;
      overflow: hidden;
    }
    .heading {
      font-weight: bold;
      text-align: center;
      margin-bottom: 10px;
    }
    .content {
      display: none;
      font-size: 14px;
      padding: 10px;
      text-align: center;
    }
    .cell:hover .content {
      display: block;
    }
    #finishTaskButton {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #finishTaskButton:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>
  <div class="grid">
    <div class="cell">
      <span class="heading">Prevalence and Types:</span>
      <span class="content">
        Skin cancer is the most common cancer globally, with millions of cases diagnosed annually. The two most common types are basal cell carcinoma and squamous cell carcinoma, while melanoma, though less common, is more likely to be fatal.
      </span>
    </div>
    <div class="cell">
      <span class="heading">Sun Protection:</span>
      <span class="content">
        Use broad-spectrum sunscreen with an SPF of 30 or higher and reapply every two hours when outdoors. Wearing wide-brimmed hats, sunglasses, and protective clothing can further reduce sun exposure.
      </span>
    </div>
    <!-- Add all remaining cells here -->
  </div>
  <button id="finishTaskButton">Finish Task</button>
  <script>
    // Extract ResponseID from the URL
    const urlParams = new URLSearchParams(window.location.search);
    const responseID = urlParams.get('ResponseID');
    console.log("Participant ResponseID:", responseID);

    // Initialize timing variables
    const interactionData = [];
    const totalStartTime = Date.now();

    // Track time spent on each cell
    document.querySelectorAll('.cell').forEach((cell, index) => {
      let cellStartTime;

      cell.addEventListener('mouseenter', () => {
        cellStartTime = Date.now();
      });

      cell.addEventListener('mouseleave', () => {
        const cellTimeSpent = Date.now() - cellStartTime;
        interactionData.push({
          cell: index + 1,
          timeSpent: cellTimeSpent,
          timestamp: new Date().toISOString(),
        });
        console.log(`Cell ${index + 1} hovered for ${cellTimeSpent} ms`);
      });
    });

    // Function to send data to Qualtrics
    function sendDataToQualtrics() {
      const totalTimeSpent = Date.now() - totalStartTime;
      console.log("Triggering sendDataToQualtrics...");
      console.log("Total time spent on task:", totalTimeSpent);
      console.log("Cell interaction data:", interactionData);

      if (window.parent && window.parent.Qualtrics && window.parent.Qualtrics.SurveyEngine) {
        console.log("Qualtrics API is available.");
        window.parent.Qualtrics.SurveyEngine.setEmbeddedData("totalTime", totalTimeSpent);
        window.parent.Qualtrics.SurveyEngine.setEmbeddedData("interactions", JSON.stringify(interactionData));
        console.log("Data sent to Qualtrics:");
        console.log("Total Time:", totalTimeSpent);
        console.log("Interactions:", interactionData);
      } else {
        console.error("Qualtrics API is not available or accessible.");
      }
    }

    // Trigger sendDataToQualtrics when the "Finish Task" button is clicked
    document.getElementById("finishTaskButton").addEventListener("click", () => {
      sendDataToQualtrics();
      alert("Task data saved. You may proceed with the survey.");
    });
  </script>
</body>
</html>


